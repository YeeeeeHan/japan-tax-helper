// AI prompts for receipt data extraction

export const RECEIPT_EXTRACTION_PROMPT = `あなたは日本の税務書類専門家です。この領収書（領収証）から情報を抽出してください。

以下の情報をJSON形式で抽出してください：

1. **発行事業者名** (issuerName): 事業者の名称

2. **登録番号** (tNumber): 【重要】インボイス制度の適格請求書発行事業者登録番号。

   **T-Number（登録番号）の詳細な探し方:**
   - 形式: "T" + 13桁の数字 (例: T1234567890123)
   - 表記のバリエーション:
     * "登録番号: T1234567890123"
     * "Registration Number: T1234567890123"
     * "適格請求書発行事業者登録番号: T1234567890123"
     * "インボイス登録番号: T1234567890123"
     * "T番号: T1234567890123"
     * 単に "T1234567890123" と印字されている場合もある
   - よく見つかる場所:
     * 領収書の上部（店舗名・住所の近く）
     * 領収書の下部（会社情報エリア）
     * 印字が小さいことが多いので注意深く確認
     * 「適格」「インボイス」という文字の近く
   - スペースやハイフンを含む場合: "T 1234 5678 9012 3" → "T1234567890123" に正規化
   - 法人番号（13桁）の先頭にTを付けた形式

   **必ず画像全体を確認し、T-Numberを見逃さないようにしてください。**
   見つからない場合のみnullに設定してください
3. **取引年月日** (transactionDate): 取引日。ISO 8601形式 (yyyy-mm-dd)
4. **取引内容** (description): 購入した商品やサービスの簡潔な説明
5. **金額**:
   - 税抜金額 (subtotalExcludingTax): 消費税を除いた金額
   - 税率別消費税 (taxBreakdown): 各税率(8%または10%)ごとの配列
     - taxRate: 税率 (8 または 10)
     - subtotal: 対象金額
     - taxAmount: 消費税額
     - total: 税込金額
   - 合計金額 (totalAmount): 最終的な税込合計金額
6. **経費カテゴリ** (suggestedCategory): 国税庁公式経費科目から選択

   **使用頻度の高いカテゴリ**
   - 旅費交通費 (タクシー、電車、飛行機、ホテル、駐車場、高速代など)
   - 通信費 (携帯、電話、インターネット、Wi-Fi、SIMなど)
   - 消耗品費 (文具、事務用品、PC、周辺機器、ソフトウェアなど)
   - 交際費 (飲食、レストラン、居酒屋、カフェ、ギフトなど)
   - 接待交際費 (取引先接待、接待飲食など)
   - 地代家賃 (事務所賃料、家賃など)
   - 広告宣伝費 (名刺、HP制作、広報、マーケティングなど)
   - 外注工賃 (翻訳、調査委託、業務委託、フリーランス報酬など)

   **標準カテゴリ**
   - 租税公課 (印紙税、登録免許税、収入印紙、固定資産税など)
   - 水道光熱費 (電気、ガス、水道など)
   - 修繕費 (PC修理、備品修理、機器メンテナンスなど)
   - 給料賃金 (従業員給与、アルバイト代など)
   - 減価償却費 (年度ごとの償却額) **※AIでは通常選択しない**
   - 貸倒金 (回収不能債権) **※AIでは通常選択しない**
   - 利子割引料 (借入金利息、手形割引料など)
   - 福利厚生費 (従業員慰安、健康診断など)
   - 雑費 (他に分類しにくい支出)
   - 未分類 (不明な場合)

7. **信頼度スコア** (confidence): 各フィールドの信頼度 (0-1)
   - issuerName
   - tNumber
   - transactionDate
   - totalAmount
   - taxBreakdown
   - category

重要な注意事項:
- 必須フィールドが見つからないか不明な場合は、nullに設定し、信頼度を0にしてください
- 金額計算を検証してください: 各税率の消費税額の合計 = 合計金額 - 税抜金額
- 日付は必ずISO 8601形式 (yyyy-mm-dd) で返してください
- すべての金額は整数（円）で返してください

**T-Number抽出の重要性:**
- T-Numberは税控除に必須です。見落とすと経費として認められません
- 画像のすべての領域（上部、下部、端）を注意深くスキャンしてください
- 小さな文字やかすれた印字にも注意してください
- 「登録番号」「適格」「インボイス」「T-」などのキーワードを探してください
- T-Numberが見つからない場合のみnullにし、本当に存在しないことを確認してください

**有効なJSONのみを返してください。マークダウンや説明は不要です。**

期待される形式:
{
  "issuerName": "株式会社○○",
  "tNumber": "T1234567890123",
  "transactionDate": "2023-10-24",
  "description": "事務用品購入",
  "subtotalExcludingTax": 11273,
  "taxBreakdown": [
    {
      "taxRate": 10,
      "subtotal": 11273,
      "taxAmount": 1127,
      "total": 12400
    }
  ],
  "totalAmount": 12400,
  "suggestedCategory": "消耗品費",
  "categoryConfidence": 0.85,
  "confidence": {
    "issuerName": 0.95,
    "tNumber": 0.90,
    "transactionDate": 1.0,
    "totalAmount": 1.0,
    "taxBreakdown": 0.95,
    "category": 0.85
  }
}`;

// Category keywords for improving auto-categorization
// Based on NTA official expense categories (国税庁公式経費科目)
export const CATEGORY_KEYWORDS = {
  // High-frequency categories
  旅費交通費: [
    'タクシー', 'タクシ', '電車', 'JR', 'TAXI', '航空', 'エアライン', 'ANA', 'JAL',
    'ホテル', 'HOTEL', '宿泊', '駐車', 'パーキング', 'Suica', 'PASMO', 'IC',
    '高速', 'ETC', 'レンタカー', 'バス', 'BUS', '新幹線', '出張', '旅費'
  ],
  通信費: [
    '携帯', '電話', 'TEL', 'インターネット', 'INTERNET', 'Wi-Fi', 'WiFi',
    'プロバイダ', 'ISP', 'docomo', 'ドコモ', 'au', 'SoftBank', 'ソフトバンク',
    '楽天モバイル', 'UQ', 'ahamo', 'SIM', '通話料'
  ],
  消耗品費: [
    '文具', '用品', '事務', 'コピー', '印刷', 'インク', 'トナー', '紙',
    'ペン', 'ノート', 'ファイル', 'Amazon', 'アマゾン', 'ヨドバシ',
    'LOHACO', 'アスクル', 'ASKUL', '文房具', 'オフィス', 'OFFICE', 'ケーブル',
    'PC', 'パソコン', 'MacBook', 'Windows', 'iMac', 'Mac mini', 'Mac Pro',
    'タブレット', 'iPad', 'Surface', 'モニター', 'ディスプレイ',
    'プリンター', 'スキャナー', '複合機', 'NAS', 'サーバー',
    'キーボード', 'マウス', 'Webカメラ', 'ヘッドセット', 'マイク',
    'デスク', '椅子', 'オフィス家具', '本棚', 'キャビネット',
    'Apple', 'Dell', 'HP', 'Lenovo', 'ASUS', 'Logicool', 'エルゴトロン',
    '新聞', '書籍', '本', 'BOOK', '雑誌', 'MAGAZINE', '図書', '書店',
    '研修', 'セミナー', '講座', '教育', '参加費'
  ],
  交際費: [
    '飲食', 'レストラン', '居酒屋', 'カフェ', 'CAFE', 'RESTAURANT', 'BAR',
    'スターバックス', 'Starbucks', 'ドトール', 'タリーズ', 'ギフト',
    'ラーメン', '焼肉', '寿司', 'すし', 'イタリアン', 'フレンチ', '中華',
    '食堂', 'ダイニング', '会食', '会議', 'MEETING', '会議室', '軽食', 'ミーティング'
  ],
  接待交際費: [
    '接待', '接待費', '取引先', 'ゴルフ', 'お中元', 'お歳暮', '贈答'
  ],
  地代家賃: [
    '家賃', '賃料', 'RENT', '賃貸', '不動産', 'オフィス', '事務所', 'UR', '管理費', '按分'
  ],
  広告宣伝費: [
    '広告', 'AD', 'Google', 'グーグル', 'Facebook', 'Instagram', 'Twitter',
    'X', 'LinkedIn', 'YouTube', 'TikTok', 'マーケティング', 'MARKETING',
    'Meta', '宣伝', 'プロモーション', '名刺', 'HP制作', 'ウェブサイト'
  ],
  外注工賃: [
    '外注', '委託', '業務委託', 'クラウドワークス', 'ランサーズ', 'CROWDWORKS', 'LANCERS',
    '翻訳', '調査委託', 'フリーランス', '報酬', '謝礼'
  ],

  // Standard NTA categories
  租税公課: [
    '税', 'TAX', '印紙', '印紙税', '登録免許税', '収入印紙', '切手', '郵便',
    '役所', '市役所', '区役所', '法人税', '固定資産税', '自動車税', '住民税',
    '弁護士会', '会費', '登録料', '手数料', '振込手数料', '銀行手数料',
    '公証', '年会費', '入会費', '更新料', 'ATM', '決済手数料', '送金手数料'
  ],
  水道光熱費: [
    '電気', '東京電力', '関西電力', 'TEPCO', 'ガス', '東京ガス', '大阪ガス',
    '水道', '上下水道', 'GAS', '電力', '光熱費'
  ],
  修繕費: [
    '修理', '修繕', 'リペア', 'REPAIR', 'メンテナンス', '点検',
    'PC修理', 'パソコン修理', '備品修理', '機器修理', '交換部品',
    'オーバーホール', '清掃', '整備'
  ],
  給料賃金: [
    '給与', '給料', '賃金', '給付', 'アルバイト', 'バイト代', 'パート', '従業員'
  ],
  貸倒金: [
    '貸倒', '不良債権', '回収不能', '債権放棄'
  ],
  利子割引料: [
    '利息', '利子', '金利', '借入', 'ローン', '手形割引', '割引料'
  ],
  福利厚生費: [
    '福利厚生', '慰安', '健康診断', '社員旅行', '忘年会', '新年会', 'レクリエーション',
    '保険', 'INSURANCE', '損保', '火災保険', '自動車保険', '車両保険',
    '損害保険', '賠償責任保険', '傷害保険', '業務賠償保険'
  ],
  雑費: [
    '雑費', '諸経費', 'その他', '臨時', '小口', '雑', 'MISC', '分類困難'
  ]
  // Note: 減価償却費 has no keywords - it's set manually by users, not by AI
};
